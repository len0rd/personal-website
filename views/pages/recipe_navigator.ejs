<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/include' ) %>
    <link rel="stylesheet" type="text/css" href="/css/projects.css">
</head>

<body>
    <header>
        <%- include('../partials/nav') %>
    </header>

    <div class="container mt-5 topMargin">
        <div class="row">
            <div class="col">
                <h1 class="display-1">Recipes</h1>
            </div>
            <div class="col-4 align-self-end">
                <input class="form-control" id="recipeSearch" type="text" placeholder="search..">
            </div>
        </div>
        <div class="row mb-2">
            <div class="col btn-container">
                <%- include('../partials/generated/recipe-tags') %>
            </div>
        </div>
        <div class="row">
            <div class="list-group list-group-flush" id="recipe-link-container">
                <%- include('../partials/generated/recipe-links') %>
            </div>
        </div>
    </div>

    <%- include('../partials/post_html_include') %>
    <script>

        /// Returns a list of the current recipe hashtags that are enabled (enabled filters)
        function getActiveTags() {
            var activeTags = [];
            // create a list of currently active tags
            $(".btn-container button").filter(function() {
                if ($(this).hasClass("btn-primary")){
                    activeTags.push($(this).text())
                }
            });
            return activeTags;
        }

        /// check if the given recipe item all the currently selected hashtag filters (an 'AND' search)
        function recipeHasAllActiveTags(activeTags, recipe) {
            const recipeTags = recipe.attr("tags").toLowerCase().split(",");
            return activeTags.every(elem => recipeTags.includes(elem));
        }

        function recipeHasCurrentSearchPhrase(searchValue, recipe) {
            return !searchValue || recipe.text().toLowerCase().indexOf(searchValue) > -1;
        }

        /// This script is responsible for filtering the recipe list
        /// based on enabled/disabled hashtags. I'm certain theres more
        /// efficient ways to do this but /shrug
        $(".btn-container").on("click", "button", function() {
            $(this).toggleClass("btn-light btn-primary");
            const activeTags = getActiveTags();
            const searchValue = $("#recipeSearch").val().toLowerCase();

            $("#recipe-link-container a").filter(function() {
                $(this).toggle(recipeHasCurrentSearchPhrase(searchValue, $(this)) && recipeHasAllActiveTags(activeTags, $(this)));
            });
        });

        /// This method is responsible for filtering the recipe list based on the search bar
        $(document).ready(function(){
            $("#recipeSearch").on("keyup", function() {
                const searchValue = $("#recipeSearch").val().toLowerCase();
                const activeTags = getActiveTags();
                $("#recipe-link-container a").filter(function() {
                    $(this).toggle(recipeHasCurrentSearchPhrase(searchValue, $(this)) && recipeHasAllActiveTags(activeTags, $(this)));
                });
            });
        });
    </script>
</body>

</html>
